- name: Ensure Downloads directory exists
  ansible.windows.win_file:
    path: C:\Users\vehant\Downloads
    state: directory

# ---------------- COPY EXE FILES ----------------
#- name: Copy EXE installers to Windows
#  ansible.windows.win_copy:
#    src: "files/{{ item.name }}"
#    dest: "C:/Users/vehant/Downloads/{{ item.name }}"
#  loop: "{{ exe_list }}"

# ---------------- COPY MSI FILES ----------------
#- name: Copy MSI installers to Windows
#  ansible.windows.win_copy:
#    src: "files/{{ item.name }}"
#    dest: "C:/Users/vehant/Downloads/{{ item.name }}"
#  loop: "{{ msi_list }}"
#



- name: Copy TAR.GZ to remote
  ansible.windows.win_copy:
    src: "files/win-pack.tar.gz"
    dest: "C:/Users/vehant/Downloads/win-pack.tar.gz"


- name: Extract tar.gz using Windows tar.exe
  ansible.windows.win_command: >
    tar -xzf C:\Users\vehant\Downloads\win-pack.tar.gz -C C:\Users\vehant\Downloads\





# ---------------- INSTALL EXEs ----------------
- name: Install EXE software using win_package
  ansible.windows.win_package:
    path: "C:/Users/vehant/Downloads/{{ item.name }}"
    state: present
    arguments: "{{ item.args }}"
    creates_path: "{{ item.creates_path }}"
  loop: "{{ exe_list }}"
  async: 1800
  poll: 15
  register: exe_install_results

# ---------------- INSTALL MSIs ----------------
- name: Install MSI software
  ansible.windows.win_package:
    path: "{{ item }}"
    state: present
  loop: "{{ msi_install }}"
  tags:
    - install_msi
  register: msi_install_results

# ---------------- SHOW RESULTS ----------------
- name: Show EXE installation results
  debug:
    var: exe_install_results

- name: Show MSI installation results
  debug:
    var: msi_install_results

